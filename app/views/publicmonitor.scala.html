@(events: List[models.Event], totalEvents: Long, frequencyEvents: Long, voltageEvents: Long, mapCenterLat: Double,
    mapCenterLng: Double, mapZoom: Int, requestFrequency: Boolean, minFrequency: Double, maxFrequency: Double, requestVoltage: Boolean, minVoltage: Double,
    maxVoltage: Double, minDuration: Int, maxDuration: Int, minTimestamp: Long, maxTimestamp: Long, iticSevere: Boolean, iticModerate: Boolean, iticOk: Boolean)
<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>OPQHub - Public Power Quality</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

            <!-- Needed libraries -->
        <script src="@routes.Assets.at("contrib/js/jquery-2.1.1.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/moment.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/bootstrap.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/bootstrap-datetimepicker.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/bootstrap-datetimepicker.min.js")" type="text/javascript"></script>

        <script src="@routes.Assets.at("contrib/js/leaflet.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/jquery.flot.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/jquery.flot.navigate.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("contrib/js/spin.min.js")" type="text/javascript"></script>

        <link rel="stylesheet" media="screen" href="@routes.Assets.at("contrib/css/bootstrap.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("contrib/css/bootstrap-datetimepicker.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("contrib/css/leaflet.css")">

            <!-- Site specific details -->
        <script src="@routes.Assets.at("js/grid-map.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("js/itic-plotter.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("js/public-map.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("js/public-filters.js")" type="text/javascript"></script>

        <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/site.css")">

            <!-- Validation -->
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/jquery.validate.min.js"></script>
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/additional-methods.min.js"></script>



    </head>
    <body>
            <!-- Responsive navbar -->
        @navbar()

            <!-- Main content -->
        <div class="container" id="main-content">

                <!-- Main two columns. Left: controls & map. Right: Events and event details. -->
            <div class="row">

                    <!-- Controls and map -->
                <div class="col-md-5">

                        <!-- Controls -->
                    <div class="row">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Display</h3>
                            </div>
                            <div class="panel-body">

                                    <!-- Frequency filter -->
                                <div class="row">
                                    <label class="col-sm-3">Freq. (Hz)</label>
                                    <div class="col-xs-1">
                                        <input type="checkbox" class="checkbox" id="requestFrequency" @if(requestFrequency){checked="checked"}>
                                    </div>
                                    <div class="form-group col-sm-4">
                                        <label class="sr-only" for="frequencyGt">Frequency Greater Than</label>
                                        <input type="text" class="form-control" id="frequencyGt" value="@minFrequency">
                                    </div>
                                    <div class="form-group col-sm-4">
                                        <label class="sr-only" for="frequencyLt">Frequency Less Than</label>
                                        <input type="text" class="form-control" id="frequencyLt" value="@maxFrequency">
                                    </div>
                                </div>

                                    <!-- Voltage filter -->
                                <div class="row">
                                    <label class="col-sm-3">Voltage (V)</label>
                                    <div class="col-xs-1">
                                        <input type="checkbox" id="requestVoltage" @if(requestVoltage){checked="checked"}>
                                    </div>
                                    <div class="form-group col-sm-4">
                                        <label class="sr-only" for="voltageGt">Voltage Greater Than</label>
                                        <input type="text" class="form-control" id="voltageGt" value="@minVoltage">
                                    </div>
                                    <div class="form-group col-sm-4">
                                        <label class="sr-only" for="voltageLt">Voltage Less Than</label>
                                        <input type="text" class="form-control" id="voltageLt" value="@maxVoltage">
                                    </div>
                                </div>

                                    <!-- Duration filter -->
                                <div class="row">
                                    <label class="col-sm-4">Duration (sec)</label>
                                    <div class="form-group col-sm-4">
                                        <label class="sr-only" for="durationGt">Duration Greater Than</label>
                                        <input type="text" class="form-control" id="durationGt" value="@minDuration">
                                    </div>
                                    <div class="form-group col-sm-4">
                                        <label class="sr-only" for="durationLt">Duration Less Than</label>
                                        <input type="text" class="form-control" id="durationLt" value="@maxDuration">
                                    </div>
                                </div>

                                    <!-- ITIC filter -->
                                <div class="row">
                                    <label class="col-sm-4 control-label">ITIC</label>
                                    <label class="col-xs-2 control-label">Severe</label>
                                    <div class="col-xs-1">
                                        <input type="checkbox" id="requestIticSevere" @if(iticSevere){checked="checked"}>
                                    </div>
                                    <label class="col-xs-2 control-label">Moderate</label>
                                    <div class="col-xs-1">
                                        <input type="checkbox" id="requestIticModerate" @if(iticModerate){checked="checked"}>
                                    </div>
                                    <label class="col-xs-1 control-label">OK</label>
                                    <div class="col-xs-1">
                                        <input type="checkbox" id="requestIticOk" @if(iticOk){checked="checked"}>
                                    </div>
                                </div>


                                    <!-- Time interval filter -->
                                <div class="row">
                                    <div class="form-group">

                                            <!-- Start time interval -->
                                        <label for="startTimestamp" class="col-sm-2 control-label">Time Interval</label>
                                        <div class="col-sm-5">
                                            <div class='input-group date' id='startTimestamp'>
                                                <input type='text' class="form-control" id="startTimestampInput"/>
                                                <span class="input-group-addon">
                                                    <span class="glyphicon glyphicon-calendar"></span>
                                                </span>
                                            </div>
                                        </div>

                                            <!-- Stop time interval -->
                                        <div class="col-sm-5">
                                            <div class='input-group date' id='stopTimestamp'>
                                                <input type='text' class="form-control" id="stopTimestampInput"/>
                                                <span class="input-group-addon">
                                                    <span class="glyphicon glyphicon-calendar"></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="error" class="verror"></div>
                                </div>

                                    <!-- Update/Reset buttons -->
                                <div class="row">
                                    <label class="col-sm-2">Actions</label>
                                    <div class="col-sm-8">
                                        <button type="button" class="btn btn-primary btn-xs updateBtn" id="updateBtn">Update</button>
                                        <button class="btn btn-danger btn-xs" id="resetBtn">Reset</button>
                                    </div>
                                </div>
                            </div>
                            <div id="messages" class="invalid"></div>
                        </div>
                    </div>

                        <!-- Map -->
                    <div class="row public-map">
                        <div class="public-map" id="public-map"></div>
                    </div>
                </div>

                    <!-- Events and event details -->
                <div class="col-md-7" id="public-map-right-col">

                        <!-- Events -->
                    <div class="row">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title" id="events-title">Events</h3>
                                <table>
                                    <tr>
                                        <td>Total Events</td> <td><span id="totalEvents" class='badge global-stats'>@totalEvents</span></td>
                                        <td>Frequency Events</td> <td><span id="totalFrequencyEvents" class='badge global-stats'>@frequencyEvents</span></td>
                                        <td>Voltage Events</td> <td><span id="totalVoltageEvents" class='badge global-stats'>@voltageEvents</span></td>
                                    </tr>
                                        <!--<tr>-->
                                        <!--<td>Registered OPQBoxes</td><td><span id="totalRegisteredDevices" class='badge global-stats'>0</span></td>-->
                                        <!--<td>Active OPQBoxes</td><td><span id="totalActiveDevices" class='badge global-stats'>0</span></td>-->
                                        <!--<td></td><td></td>-->
                                        <!--</tr>-->
                                </table>
                            </div>
                            <div class="panel-body" id="events-table">
                                <table class="table table-hover" id="events">
                                    <thead>
                                        <tr>
                                            <th>Timestamp</th>
                                            <th>Type</th>
                                            <th>Duration</th>
                                            <th>Value</th>
                                            <th>ITIC</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for(event <- events) {
                                            <tr>
                                                <td>@utils.DateUtils.toShortDateTime(event.getTimestamp)</td>
                                                <td>@event.getEventType.getName</td>
                                                <td>@event.getDuration</td>
                                                <td>
                                                    @if(event.getEventType.getName.equals("Voltage Event")){
                                                        @event.getVoltage V
                                                    }
                                                    @if(event.getEventType.getName.equals("Frequency Event")){
                                                        @event.getFrequency Hz
                                                    }
                                                </td>
                                                <td>N/A</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <div class="panel-footer">

            </div>
                        </div>
                    </div>

                        <!-- Event details -->
                    <div class="row">
                            <!-- Hidden fields that allow us to store the location of each event -->
                        <input type="hidden" id="details-center-lat" />
                        <input type="hidden" id="details-center-lng" />
                        <input type="hidden" id="details-zoom" />

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 id="event-title" class="panel-title">Event Details</h3>
                            </div>
                            <div class="panel-body">
                                <div class="col-md-4">
                                    <table class="table table-condensed">
                                        <tbody>
                                            <tr>
                                                <td>Frequency</td>
                                                <td id="details-frequency"></td>
                                            </tr>
                                            <tr>
                                                <td>Voltage</td>
                                                <td id="details-voltage"></td>
                                            </tr>
                                            <tr>
                                                <td>Duration</td>
                                                <td id="details-duration"></td>
                                            </tr>
                                            <tr>
                                                <td id="details-itic-title">ITIC</td>
                                                <td id="details-itic-severity"></td>
                                            </tr>
                                            <tr>
                                                <td>Locality</td>
                                                <td id="details-event-level"></td>
                                            </tr>
                                            <tr>
                                                <td>Location</td>
                                                <td><a class="btn-link" id="details-grid-id"></a></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div id="waveform" class="col-md-4 plot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            // Set up calendar fields correctly
            $("#startTimestamp" ).datetimepicker();
            $("#stopTimestamp" ).datetimepicker();
            $("#startTimestamp").data("DateTimePicker").setDate(new Date(@minTimestamp));
            $("#stopTimestamp").data("DateTimePicker").setDate(new Date(@maxTimestamp));

            // Initialize the map
            grid.initMap("public-map", [@mapCenterLat, @mapCenterLng], @mapZoom);

            // When update button is clicked, generate URL and goto
            $("#updateBtn").click(function() {
                var requestFrequency = $("#requestFrequency").is(':checked');
                var minFrequency = $("#frequencyGt" ).val();
                var maxFrequency = $("#frequencyLt" ).val();
                var requestVoltage = $("#requestVoltage").is(':checked');
                var minVoltage = $("#voltageGt" ).val();
                var maxVoltage = $("#voltageLt" ).val();
                var minDuration = $("#durationGt" ).val();
                var maxDuration = $("#durationLt" ).val();
                var minTimestamp = moment.utc($("#startTimestamp").data("DateTimePicker").getDate())._d.getTime();
                var maxTimestamp = moment.utc($("#stopTimestamp").data("DateTimePicker").getDate())._d.getTime();
                var iticSevere = $("#requestIticSevere").is(':checked');
                var iticModerate = $("#requestIticModerate").is(':checked');
                var iticOk = $("#requestIticOk").is(':checked');
                var mapCenterLat = grid.getCenterLat();
                var mapCenterLng = grid.getCenterLng();
                var mapZoom = grid.getZoom();
                var visibleIds = grid.getVisibleIds( ).join(";");
                visibleIds = visibleIds.split("," ).join("c");
                visibleIds = visibleIds.split(":" ).join("C");
                visibleIds = visibleIds.split(";" ).join("s");


                var baseUrl = window.location.pathname;
                var url = baseUrl + "?requestFrequency=" + requestFrequency +"&minFrequency=" + minFrequency + "&maxFrequency=" + maxFrequency +
                "&requestVoltage=" + requestVoltage + "&minVoltage=" + minVoltage + "&maxVoltage=" + maxVoltage +
                "&minDuration=" + minDuration + "&maxDuration=" + maxDuration +
                "&minTimestamp=" + minTimestamp + "&maxTimestamp=" + maxTimestamp +
                "&iticSevere=" + iticSevere + "&iticModerate=" + iticModerate + "&iticOk=" + iticOk +
                "&mapCenterLat=" + mapCenterLat + "&mapCenterLng=" + mapCenterLng + "&mapZoom=" + mapZoom +
                "&page=0&mapVisibleIds=" + visibleIds;

                window.location.href = url;
            });
        </script>
        @*
        <script type="text/javascript">
        $(document).ready(function () {


        initPage('@play.Play.application().configuration().getString("opqhub.websockets.server")');


        $("#resetBtn").click(function() {
        filters.reset();
        map.gridMap.setView(map.gridMap.island.OAHU.latLng, map.gridMap.island.OAHU.defaultZoom);
        });

        $("#updateBtn").click(function() {
        if(filters.validate('#messages')) {
        ws.requestUpdate();
        }
        });
        });
        </script>
        *@
    </body>
</html>
